let data = {
    smågatestein: [
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 10,
            amount: 60,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/637dce97f6656b88d378c885_Beer-Mix_smågatestein_brostein_4.jpg",
            note: `Dette er en laaaang merknad...
            Dette er en laaaang merknad....
            Dette er en laaaang merknad...
            .Dette er en laaaang merknad....
            Dette er en laaaang merknad....Dette er en 
            laaaang merknad....Dette er en laaaang merknad....
            Dette er en laaaang merknad....Dette er en laaaang
             merknad....Dette er en laaaang merknad....Her er slutten på teksten`,
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 8,
            amount: 87,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/234242421342.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 8,
            height: 8,
            amount: 33,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/637dce97f6656b88d378c885_Beer-Mix_smågatestein_brostein_4.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 11,
            width: 11,
            height: 8,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/3423424323235234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 12,
            width: 12,
            height: 12,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/ewr3er324524234234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 8,
            width: 8,
            height: 8,
            amount: 13,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/3423424323235234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 100,
            width: 120,
            height: 100,
            amount: 63,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/637dce97f6656b88d378c885_Beer-Mix_smågatestein_brostein_4.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 100,
            width: 100,
            height: 8,
            amount: 15,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/3423424323235234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 100,
            width: 100,
            height: 100,
            amount: 27,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/637dce97f6656b88d378c885_Beer-Mix_smågatestein_brostein_4.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 100,
            width: 100,
            height: 80,
            amount: 5,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "",
            image: "smågatestein/234242421342.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 10,
            amount: 5,
            color: "Grå",
            surface: "Saget",
            origin: "Ruten",
            stored: "Sviland",
            image: "smågatestein/fwf23e2d.jpg",
            note: "Her kan vi skrive ekstra informasjon om steinen...",
        },
    ],

    storgatestein: [
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 67,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "storgatestein/ce3werouu23440u23.jpg",
            note: "",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 67,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "storgatestein/dqwqw2332342342.jpg",
            note: "",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 67,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "storgatestein/storgate3.jpg",
            note: "",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 13,
            color: "Brun",
            surface: "",
            origin: "Lura Skole",
            stored: "Sviland",
            image: "storgatestein/storgate4.jpg",
            note: "Ble tatt opp på lura skole 2014",
        },
    ],

    belegningsstein: [
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 17,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 15,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 13,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 35,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 10,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 9,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 7,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
    ],

    tegl: [
        {
            name: "Tegl",
            material: "Keramisk",
            length: 22,
            width: 11,
            height: 5,
            amount: 85,
            color: "Brun",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "tegl/23423desf24.jpg",
            note: "",
        },
         {
            name: "Tegl",
            material: "Keramisk",
            length: 20,
            width: 10,
            height: 6,
            amount: 140,
            color: "Brun",
            surface: "",
            origin: "",
            stored: "Vatne",
            image: "tegl/tegl2.jpg",
            note: "",
        },
         {
            name: "Tegl",
            material: "Keramisk",
            length: 20,
            width: 11,
            height: 5,
            amount: 15,
            color: "Brun",
            surface: "",
            origin: "",
            stored: "Vatne",
            image: "tegl/tegl3.jpg",
            note: "",
        },
    ],

    heller: [
        {
            name: "Heller",
            material: "Betong",
            length: 60,
            width: 60,
            height: 5,
            amount: 50,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "heller/34234121.jpg",
            note: "",
        },
        {
            name: "Heller",
            material: "Betong",
            length: 30,
            width: 30,
            height: 2,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "heller/321492+408.jpg",
            note: "",
        },
    ],

    kantstein: [
        {
            name: "Kantstein",
            material: "Granitt",
            length: 1000,
            width: 120,
            height: 250,
            amount: 200,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kantstein/23e23e232523e2.jpg",
            note: "",
        },
    ],

    kurvestein: [
         {
            name: "Kurvestein",
            material: "Granitt",
            length: 1000,
            width: 30,
            height: 20,
            amount: 27,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kurvestein/kurvestein1.jpg",
            note: "",
        },
         {
            name: "Kurvestein",
            material: "Granitt",
            length: 1000,
            width: 30,
            height: 20,
            amount: 15,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kurvestein/kurvestein2.jpg",
            note: "",
        },
    ],

    platekant: [
        {
            name: "Platekant",
            material: "Granitt",
            length: 1000,
            width: 30,
            height: 20,
            amount: 35,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "platekant/3123131.jpg",
            note: "",
        },
    ],
}


const item = [
    "smågatestein", "storgatestein", "belegningsstein", "tegl",
    "heller", "kantstein", "kurvestein", "platekant"
];


const sortSettings = {
    smågatestein: "Index",
    storgatestein: "Index",
    belegningsstein: "Index",
    tegl: "Index",
    heller: "Index",
    kantstein: "Index",
    kurvestein: "Index",
    platekant: "Index"
};


const squareMeterOrMeter = (element) => {
    if (
        element.name == "Smågatestein" ||
        element.name == "Belegningsstein" ||
        element.name == "Tegl" ||
        element.name == "Heller"
    ) {
        return `${element.amount}m²`
    } else {
        return `${element.amount}m`
    }
}


const originalData = JSON.parse(JSON.stringify(data));
const sortItems = (name, type) => {
    let ascending = document.getElementById(`${name}-sort-order`)

    if (type == "index") {
        if (ascending.textContent == "↓") {
            data[name] = [...originalData[name]];
        } else {
            data[name] = [...originalData[name]].reverse();
        }
    } else {
        if (ascending.textContent == "↑") {
            data[name].sort((a, b) => a[type] - b[type])
        } else {
            data[name].sort((a, b) => b[type] - a[type])
        }
    }

    let container = document.getElementById(`${name}-item`);
    container.innerHTML = "";
    container.append(createWindowDOM(data[name]));

    let items = container.querySelectorAll(".image");
    items.forEach(item => {
        item.addEventListener("click", selectWindow)
    });
}


const createWindowDOM = (element) => {
    const fragment = document.createDocumentFragment()

    for (let i = 0; i < element.length; i++) {
        const mainDiv = document.createElement("div")
        const textDiv = document.createElement("div")
        const image = document.createElement("img")

        mainDiv.classList.add("image")
        mainDiv.id = `${element[i].name}_${i}`

        textDiv.classList.add("item-text")
        textDiv.textContent = `${element[i].length} x ${element[i].width} x ${element[i].height} | ` + squareMeterOrMeter(element[i])

        image.src = element[i].image

        mainDiv.append(textDiv, image)
        fragment.append(mainDiv)
    }
    return fragment
}


const makeWindows = () => {
    for (let i = 0; i < item.length; i++) {
        let key = item[i]
        let dataArray = data[key]

        if (!dataArray || dataArray.length === 0 || !dataArray[0].name) continue;


        document.getElementById(`${key}-item`).append(createWindowDOM(dataArray))
    }

    let types = document.querySelectorAll(".sort-type")
    types.forEach((item) => {
        if (item.id.includes("index")) {
            item.style.color = "lightgreen";
            currentSelected = item
        }
    })
}
makeWindows();


let selected = null;
const selectWindow = (event) => {
    let [materialRaw, numberRaw] = event.currentTarget.id.split("_")
    let material = materialRaw.toLowerCase();
    let number = parseInt(numberRaw)

    displayInfo(data[material][number])

    let currentImage = document.getElementById(event.currentTarget.id)
    if (currentImage !== selected) {
        if (selected !== null) {
            selected.classList.remove("selected")
        }
        selected = currentImage
        currentImage.classList.add("selected")
    }
}


const displayInfo = (currentObject) => {
    let image = document.getElementById("info-image")
    let name = document.getElementById("info-name")
    let material = document.getElementById("info-material")
    let dimensions = document.getElementById("info-dimensions")
    let amount = document.getElementById("info-amount")
    let color = document.getElementById("info-color")
    let surface = document.getElementById("info-surface")
    let origin = document.getElementById("info-origin")
    let stored = document.getElementById("info-stored")
    let note = document.getElementById("info-note")

    image.src = currentObject.image
    name.textContent = `Type: ${currentObject.name}`
    material.textContent = `Materiale: ${currentObject.material}`
    dimensions.textContent = `Dimensjoner: ${currentObject.length} x ${currentObject.width} x ${currentObject.height}`
    amount.textContent = `Mengde: ${squareMeterOrMeter(currentObject)}`
    color.textContent = `Farge: ${currentObject.color}`
    surface.textContent = `Overflatebehandling: ${currentObject.surface}`
    origin.textContent = `Opprinnelse: ${currentObject.origin}`
    stored.textContent = `Lagret på: ${currentObject.stored}`
    note.textContent = `Merknad: ${currentObject.note}`
}


const mininmizeButton = (event) => {
    let btn = event.currentTarget
    let line = event.currentTarget.id.split("-")[0]
    let container = document.getElementById(`${line}-item`)

    if (btn.textContent == "-") {
        btn.textContent = "+"
        container.classList.add("collapsed-line")
    } else if (btn.textContent == "+") {
        btn.textContent = "-"
        container.classList.remove("collapsed-line")
    }
}


const sortButtonDropdown = (event) => {
    let buttonId = event.currentTarget.id //smågatestein-sort-btn
    let dropdownMenu = document.getElementById(`${buttonId.split("-")[0]}-sort-dropdown`) //whole div
    let allDropdownMenu = document.querySelectorAll(".sort-dropdown") //node list

    const OPEN = "sort-dropdown-open"
    const CLOSED = "sort-dropdown-closed"

    if (dropdownMenu.classList.contains(CLOSED)) {
        allDropdownMenu.forEach(item => {
            item.classList.add(CLOSED)
            item.classList.remove(OPEN)
        })

        dropdownMenu.classList.remove(CLOSED)
        dropdownMenu.classList.add(OPEN)

    } else if (dropdownMenu.classList.contains(OPEN)) {
        dropdownMenu.classList.remove(OPEN)
        dropdownMenu.classList.add(CLOSED)
    }
}


const highlightSortType = (item) => {
    let type = item.id.split("-")[0];
    let elements = document.querySelectorAll(`.${type}-sort-type`);

    elements.forEach(el => el.style.color = "#fff");
    item.style.color = "lightgreen";
};


//Window Select
let itemWindow = document.querySelectorAll(".image");
itemWindow.forEach(item => {
    item.addEventListener("click", selectWindow)
});

//Minimize Lines
let allMinBtn = document.querySelectorAll(".minimize-btn");
allMinBtn.forEach(item => {
    item.textContent = "-"
    item.addEventListener("click", mininmizeButton)

    item.addEventListener("mousedown", () => {
        item.style.transform = "scale(0.90)";
    })
    item.addEventListener("mouseup", () => {
        item.style.transform = "scale(1)";
    })
})

//Sorting dropdown menu
let allSortBtn = document.querySelectorAll(".sort-btn")
allSortBtn.forEach(item => {
    let name = item.id.split("-")[0]

    item.addEventListener("click", sortButtonDropdown)

    item.addEventListener("mousedown", () => {
        item.style.transform = "scale(0.90)";
    })
    item.addEventListener("mouseup", () => {
        item.style.transform = "scale(1)";
    })
    item.textContent = `Sortèr: ${sortSettings[name]}`
})

//Sorting Selection
let sortTypeButton = document.querySelectorAll(".sort-type")
sortTypeButton.forEach(item => {
    item.addEventListener("click", () => {

        //smågatestein, length
        let [name, , sortType] = item.id.split("-")

        highlightSortType(item)
        sortItems(name, sortType)

        //Update Sort Button textContent
        sortSettings[name] = document.getElementById(`${name}-sort-${sortType}`).textContent
        document.getElementById(`${name}-sort-btn`).textContent = `Sortèr: ${sortSettings[name]}`

        //close menu when something is selected
        if (sortTypeButton) {
            document.querySelectorAll(".sort-dropdown").forEach(menu => {
                menu.classList.remove("sort-dropdown-open");
                menu.classList.add("sort-dropdown-closed");
            });
        }
    })
})

//Close menu when clicking outside
document.addEventListener("click", (event) => {
    let isButton = event.target.closest(".sort-btn");
    let isMenu = event.target.closest(".sort-dropdown");

    if (!isButton && !isMenu) {
        document.querySelectorAll(".sort-dropdown").forEach(menu => {
            menu.classList.remove("sort-dropdown-open");
            menu.classList.add("sort-dropdown-closed");
        });
    }
});

//Ascending/Descending
let ascendingSortBtn = document.querySelectorAll(".sort-order-btn")
ascendingSortBtn.forEach(item => {
    item.textContent = "↓"
    item.addEventListener("click", () => {

        //Change textContent
        item.textContent = item.textContent == "↓" ? "↑" : "↓";

        //Lookup textContent, convert to sortSettings[name]
        let nameConvention = (name) => {
            if (name == "Index") return "index"
            if (name == "Lengde") return "length"
            if (name == "Bredde") return "width"
            if (name == "Høyde") return "height"
            if (name == "Mengde") return "amount"
        }

        let name = item.id.split("-")[0]
        sortItems(name, nameConvention(sortSettings[name]))

        item.addEventListener("mousedown", () => {
            item.style.transform = "scale(0.90)";
        })
        item.addEventListener("mouseup", () => {
            item.style.transform = "scale(1)";
        })
    })
})

//Overlay Image
let bigImage = document.getElementById("info-image");
let overlay = document.getElementById("image-overlay");
let overlayImg = document.getElementById("overlay-img");
bigImage.addEventListener("click", () => {
    overlayImg.src = bigImage.src;
    overlay.style.display = "flex";

    overlayImg.style.width = "";
    overlayImg.style.height = "";

    if (bigImage.Width > bigImage.Height) {
        overlayImg.style.width = "90vh";
    } else {
        overlayImg.style.height = "90vh";
    }
})

//Close overlay image
overlay.addEventListener("click", () => {
    overlay.style.display = "none";
});